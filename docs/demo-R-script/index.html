<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","G-TMZK4YFDGL","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-TMZK4YFDGL"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-TMZK4YFDGL",{anonymize_ip:!0})</script><title data-react-helmet="true">Step-by-step Demo | Robyn</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://facebookexperimental.github.io/Robyn/docs/demo-R-script"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Step-by-step Demo | Robyn"><meta data-react-helmet="true" name="description" content="We recommend to use our demo.R script in order to"><meta data-react-helmet="true" property="og:description" content="We recommend to use our demo.R script in order to"><link data-react-helmet="true" rel="shortcut icon" href="/Robyn/img/robyn_logo.png"><link data-react-helmet="true" rel="canonical" href="https://facebookexperimental.github.io/Robyn/docs/demo-R-script"><link data-react-helmet="true" rel="alternate" href="https://facebookexperimental.github.io/Robyn/docs/demo-R-script" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://facebookexperimental.github.io/Robyn/docs/demo-R-script" hreflang="x-default"><link rel="stylesheet" href="/Robyn/assets/css/styles.e77be50e.css">
<link rel="preload" href="/Robyn/assets/js/runtime~main.30fdf14c.js" as="script">
<link rel="preload" href="/Robyn/assets/js/main.0ba7addf.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><div class="announcementBar_3WsW" style="background-color:#20232a;color:#fff" role="banner"><div class="announcementBarContent_3EUC">Support Ukraine 🇺🇦 <a target="_blank" rel="noopener noreferrer" href="https://opensource.facebook.com/support-ukraine"> Help Provide Humanitarian Aid to Ukraine</a>.</div></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/Robyn/"><img src="/Robyn/img/robyn_logo.png" alt="Robyn Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/Robyn/img/robyn_logo.png" alt="Robyn Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Robyn</b></a><a class="navbar__item navbar__link" href="/Robyn/docs/quick-start/">Docs</a><a class="navbar__item navbar__link" href="/Robyn/docs/about">About</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebookexperimental/Robyn" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">🌞</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">How-to guide</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/Robyn/docs/quick-start">Quick Start</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/Robyn/docs/demo-R-script">Step-by-step Demo</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/Robyn/docs/step-by-step-videos">Walkthrough videos</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Robyn at a glance</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Analysts guide to MMM</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Features</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Getting help and contributing</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">About Robyn</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Learning with the demo</h1></header><p>We recommend to use our <a href="https://github.com/facebookexperimental/Robyn/blob/main/demo/demo.R" target="_blank" rel="noopener noreferrer">demo.R</a> script in order to
learn and explore what are the steps to build a model using Robyn. This guide is intended to help you walk through the demo, understand how to:</p><ol><li><strong>Load</strong> the data</li><li><strong>Define</strong> model specifications<ol><li>Specify model <strong>inputs</strong> and parameters</li><li>Define <strong>hyperparameter possible values</strong> for adstock and saturation curves</li><li>Determine <strong>calibration</strong> inputs</li><li>Input a <strong>fix model</strong> setup in one single step</li></ol></li><li><strong>Build</strong> your initial model</li><li><strong>Select</strong> your preferred initial model <strong>solution</strong></li><li>Calculate <strong>budget allocation</strong> based on the selected model</li><li>Execute a <strong>model refresh</strong> to add new recent data</li><li>Get <strong>budget allocation</strong> for new model <strong>refresh periods</strong></li><li>Obtain <strong>marginal returns</strong></li></ol><hr><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="step-1-load-the-data"></a>Step 1: Load the data<a class="hash-link" href="#step-1-load-the-data" title="Direct link to heading">#</a></h2><hr><p>Once you have the <a href="https://github.com/facebookexperimental/Robyn/blob/main/demo/demo.R" target="_blank" rel="noopener noreferrer">demo.R</a> script open, you will have to either, load the simulated dataset, or load your own data. Just change ‘dt_simulated weekly’ name to any name your dataset may have. Please have in mind it should be of the data.frame class.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">data(&quot;dt_simulated_weekly&quot;)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">head(dt_simulated_weekly)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The next step is to load and check the holidays data for Prophet to include them when decomposing seasonality, trend and holiday effects in the data.</p><p>Prophet includes data for holidays within 59 countries already.
If your country is not included in the ‘dt_prophet_holidays’ data frame, please manually add it to the dt_prophet_holidays data table.</p><p><em>Pro Tip:</em> <em>any type of events can be added into this table, not only holidays. E.g. school break, black friday, cyber monday, etc.</em></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">data(&quot;dt_prophet_holidays&quot;)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">head(dt_prophet_holidays)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Finally you should work on defining the robyn object where everything you run will be saved.
The object must be of the extension .Rdata. The object name can be anything different than Robyn too:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">robyn_object &lt;- &quot;~/Desktop/Robyn.RData&quot;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><hr><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="step-2--model-specifications"></a>Step 2:  Model specifications<a class="hash-link" href="#step-2--model-specifications" title="Direct link to heading">#</a></h2><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="step-2a-1-specifying-the-input-data-and-model-parameters"></a>Step 2a-1: Specifying the input data and model parameters<a class="hash-link" href="#step-2a-1-specifying-the-input-data-and-model-parameters" title="Direct link to heading">#</a></h3><hr><p>The first thing you will have to do is to define <strong><code>robyn_inputs()</code></strong>, which is the function to input all model parameters and check their correctness for the initial model build.
You will have to define the following input parameters:</p><ul><li><strong><code>dt_input</code></strong>
A data.frame. Raw input data which may contain a response variable like revenue, sales or conversions; a set of media variables for channels spend, impressions and/or clicks; and organic, factor or context variables. Load the simulated dataset by running: <code>data(&quot;dt_simulated_weekly&quot;)</code></li><li><strong><code>dt_holidays</code></strong>
A data.frame. Raw input holiday data. Load default Prophet holidays data by running: <code>data(&quot;dt_prophet_holidays&quot;)</code></li><li><strong><code>date_var</code></strong>
A character. This is where you indicate the model what is the name of the date variable. The objective is to tell the model which column to work with for the time series. Daily, weekly and monthly data are supported. Weekly data requires a weekstart of Monday or Sunday. date_var must be of the &#x27;&#x27;YYYY-MM-DD&#x27;&#x27; format. E.g. &quot;2020-01-01&quot;. Default to automatic date detection.</li><li><strong><code>dep_var</code></strong>
A character. This is the name of the dependent variable. It can be sales, conversions or any other numeric or monetary business outcome. Only one dependent variable is allowed.</li><li><strong><code>dep_var_type</code></strong>
A character. This is the type of dependent variable, which can be <code>&quot;revenue&quot;</code> or <code>&quot;conversion&quot;</code>. Revenue indicates a monetary value type (E.g. $), whereas, conversion defines a dependent variable that will be just a numeric value (E.g. total units sold). Only one dependent variable type is allowed and case sensitive.</li><li><strong><code>prophet_vars</code></strong>
A character vector. It must Include any of <code>&quot;trend&quot;, &quot;season&quot;, &quot;weekday&quot;, &quot;holiday&quot;</code> which are case-sensitive. <code>&quot;trend&quot;, &quot;season&quot;, &quot;holiday&quot;</code> and especially <code>“weekday”</code> are highly advised to be included when working with daily data in order to account for weekly seasonality effects. For weekly or monthly data granularity, we recommend to use just <code>&quot;trend&quot;, &quot;season&quot;, &quot;holiday&quot;</code>.</li><li><strong><code>prophet_signs</code></strong>
A character vector. Choose any of <code>c(&quot;default&quot;, &quot;positive&quot;, &quot;negative&quot;)</code>. This input variable controls the signs of coefficients for prophet variables. If the sign is set as “default” it means it will be possible for the model to reflect either a positive or negative effect of the prophet variable <code>(&quot;trend&quot;, &quot;season&quot;, &quot;weekday&quot;, &quot;holiday&quot;)</code> onto the response variable regressed (Conversions, revenue, etc.). The prophet signs vector must have the same length as <code>prophet_vars</code>. The sign variables order matters, as it will be mapped literally 1:1 to the <code>prophet_vars</code> vector. E.g. If <code>prophet_vars</code> is <code>c(&quot;trend&quot;, &quot;season&quot;, &quot;holiday&quot;)</code> and <code>prophet_signs</code> is <code>c(&quot;default&quot;, &quot;default&quot;, &quot;positive&quot;)</code> then this means trend and season can be either negative or positive, while holiday effects on the dependent variable will be forced to be positive only.</li><li><strong><code>prophet_country</code></strong>
A character. Only one country is allowed at a time. This indicates which country to use from the default <code>“dt_holidays”</code> Prophet file. Includes national holidays for 59 countries, you may review the list by running: <code>data(&quot;dt_prophet_holidays&quot;)</code>.</li><li><strong><code>context_vars</code></strong>
A character vector. These are context variables that can help explain the dependent variable behavior in time and that are not paid media. Most common examples of these are: competitors, price &amp; promotion, temperature, unemployment rate, etc.</li><li><strong><code>context_signs</code></strong>
A character vector. Choose any of <code>c(&quot;default&quot;, &quot;positive&quot;, &quot;negative&quot;)</code>. This input variable controls the signs of coefficients for context_vars. If the sign is set as <code>“default”</code> it means it will be possible for the model to reflect either a positive or negative effect of the context variable onto the response variable. Must have the same length as <code>context_vars</code>. The sign variables order matters, as it will be mapped literally 1:1 to the <code>context_vars</code> vector. E.g. If <code>context_vars</code> is <code>c(&quot;promotion&quot;, &quot;unemployment&quot;)</code> and <code>prophet_signs</code> is <code>c(&quot;default&quot;, &quot;negative&quot;)</code> then this means promotion can be either negative or positive, while unemployment effects on the dependent variable will be forced to be negative only.</li><li><strong><code>paid_media_vars</code></strong>
A character vector. These are the names of the media variables that will be used in the model. It is recommended to use metrics that better reflect media-exposure such as impressions, clicks or GRPs instead of spend. It is also advised to split media channels into sub-channels (e.g. fb_retargeting, fb_prospecting etc.) to be able to explain more variance. <code>“paid_media_vars”</code> only accepts numeric variables.</li><li><strong><code>paid_media_signs</code></strong>
A character vector. Choose any of <code>c(&quot;default&quot;, &quot;positive&quot;, &quot;negative&quot;)</code>. This input variable controls the signs of coefficients for paid_media_vars. If the sign is set as <code>“default”</code> it means it will be possible for the model to reflect either a positive or negative effect of the paid media variable onto the response variable. Must have the same length as <code>paid_media_vars</code>. The sign variables order matters, as it will be mapped literally 1:1 to the <code>paid_media_vars</code> vector. E.g. If <code>paid_media_vars</code> is <code>c(&quot;facebook_I&quot;, &quot;ooh_S&quot;)</code> and <code>prophet_signs</code> is <code>c(&quot;default&quot;, &quot;positive&quot;)</code> then this means facebook_I effect can be either negative or positive, while ooh_S effects on the dependent variable will be forced to be positive only.</li><li><strong><code>paid_media_spends</code></strong>
A character vector. This input variable indicates the media spends for each of the channels defined on paid_media_vars. We will use spend to link it to exposure level metrics (impressions, clicks, GRPs, etc.) in paid_media_vars, in order to provide ROAS calculation. If you input spend metrics in <code>paid_media_vars</code>, please repeat the same name as in <code>paid_media_vars</code>. However, if you a input a non-spend metric within <code>paid_media_vars</code> (Impressions, clicks, etc.) then you should input the related spend associated with that channel and non-spend metric.  <code>media_spend_vars</code> must have the same channel to channel matching order and same length as <code>paid_media_vars</code>.</li><li><strong><code>organic_vars</code></strong>
A character vector. Typically newsletter emails sent, push-notifications, social media posts, etc. Compared to <code>paid_media_vars</code>, <code>organic_vars</code> are often marketing activities without a clear marketing spend.</li><li><strong><code>organic_signs</code></strong>
A character vector. Choose any of <code>c(&quot;default&quot;, &quot;positive&quot;, &quot;negative&quot;)</code>. This input variable controls the signs of coefficients for <code>organic_signs</code>. If the sign is set as <code>“default”</code> it means it will be possible for the model to reflect either a positive or negative effect of the organic media variable onto the response variable. Must have the same order and same length as <code>organic_vars</code>. The sign variables order matters, as it will be mapped literally 1:1 to the <code>organic_vars</code> vector. E.g. If <code>organic_vars</code> is <code>c(&quot;newsletter&quot;, &quot;push-notifications&quot;)</code> and <code>prophet_signs</code> is <code>c(&quot;default&quot;, &quot;positive&quot;)</code> then this means newsletter effect can be either negative or positive, while push-notifications effects on the dependent variable will be forced to be positive only.</li><li><strong><code>factor_vars</code></strong>
A character vector. Specify which of the provided variables in <code>organic_vars</code> or <code>context_vars</code> should be used as a factor categorical variable.</li><li><strong><code>adstock</code></strong>
A character. Choose any of <code>c(&quot;geometric&quot;, &quot;weibull&quot;)</code>. <code>Weibull</code> adstock is a two-parametric function and thus more flexible in shape, but it takes longer processing times than the traditional <code>geometric</code> one-parametric function. Time estimation: with geometric adstock, 2000 iterations * 5 trials on 8 cores, it should take less than 30 minutes. Whereas weibull takes at least twice as much time.</li><li><strong><code>hyperparameters</code></strong>
List containing the hyperparameter lower and upper ranges. The names of the elements in the list must be identical to the output of <code>hyper_names()</code></li><li><strong><code>window_start</code></strong>
A character. Set the start date of the modelling period. The window start will determine the start date of the data period within your dataset you will be using to specifically regress the effects of media, organic and context variables on your dependent variable. We recommend using a full <code>“dt_input”</code> dataset with a minimum of 1 year of history, as it will be used in full for the model calculation of trend, seasonality and holidays effects. Whereas the window period will determine how much of the full data set will be used for media, organic and context variables. E.g. Uploading and using 2 years of data in <code>“dt_input”</code> but determining <code>window_start</code> and <code>window_end</code> as the last 6 months which reflect better the current business and/or marketing investment reality for budget decision making.</li><li><strong><code>window_end</code></strong>
A character. Set end date of modelling period. Recommended to have ratio of independent variable data points of 1:10.
The window end will determine the end date of the data period within your dataset you will be using to specifically regress the effects of media, organic and context variables on your dependent variable. We recommend using a full <code>“dt_input”</code> dataset with a minimum of 1 year of history, as it will be used in full for the model calculation of trend, seasonality and holidays effects. Whereas the window period will determine how much of the full data set will be used for media, organic and context variables. E.g. Uploading and using 2 years of data in <code>“dt_input”</code> but determining <code>window_start</code> and <code>window_end</code> as the last 6 months which reflect better the current business and/or marketing investment reality for budget decision making.</li><li><strong><code>cores</code></strong>
An integer. Default to <code>parallel::detectCores()</code></li><li><strong><code>iterations</code></strong>
An integer. Recommended 2000 for <code>defaultnevergrad_algo = &quot;TwoPointsDE&quot;</code></li><li><strong><code>trials</code></strong>
An integer. Recommended 5 for <code>default nevergrad_algo = &quot;TwoPointsDE&quot;</code></li><li><strong><code>nevergrad_algo</code></strong>
A character. Default to <code>&quot;TwoPointsDE&quot;</code>. Options arec(&quot;DE&quot;,&quot;TwoPointsDE&quot;, &quot;OnePlusOne&quot;, &quot;DoubleFastGADiscreteOnePlusOne&quot;, &quot;DiscreteOnePlusOne&quot;, &quot;PortfolioDiscreteOnePlusOne&quot;, &quot;NaiveTBPSA&quot;, &quot;cGA&quot;, &quot;RandomSearch&quot;)</li><li><strong><code>calibration_input</code></strong>
A data.table. It is optional to provide experimental results. We strongly recommend using experimental and causal results that are considered ground truth to calibrate MMM. Usual experiment types are people-based (e.g. Facebook conversion lift) and geo-based (e.g. Facebook GeoLift). Currently, Robyn only accepts point-estimates as calibration input. E.g. with a 50/50 split between control and test groups if you identify $70k in sales on holdout vs. $110k on test. Then you may input $110k-$70k = $40k as the incremental point-estimate for calibration.</li><li><strong><code>InputCollect</code></strong>
Default to NULL. <code>robyn_inputs</code>&#x27;s output when hyperparameters are not yet set.</li></ul><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="step-2a-2-defining-hyperparameters"></a>Step 2a-2: Defining hyperparameters<a class="hash-link" href="#step-2a-2-defining-hyperparameters" title="Direct link to heading">#</a></h3><p>All variables in <code>paid_media_vars</code> or <code>organic_vars</code> require hyperparameters and will be transformed by adstock and saturation curves. The difference between <code>paid_media_vars</code> and <code>organic_vars</code> is that <code>paid_media_vars</code> require spend to be specified in the <code>paid_media_spends</code> vector.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="how-to-setup-the-hyperparameters"></a>How to setup the hyperparameters<a class="hash-link" href="#how-to-setup-the-hyperparameters" title="Direct link to heading">#</a></h4><ol><li>Ensure you have the correct <strong>hyperparameter names</strong>:<ul><li>Run <strong><code>hyper_names()</code></strong> to get the correct hyperparameter names. All the names in hyperparameters object must be equal to the names from <strong><code>hyper_names()</code></strong>, case sensitive.</li></ul></li><li>Follow the guidelines for defining <strong>hyperparameter ranges</strong>:<ul><li>Please note that for geometric adstock, it is required to use theta, alpha and gamma. Whereas for weibull adstock, it is mandatory to use shape, scale, alpha and gamma.<ol><li><strong>Theta</strong>: In geometric adstock, theta is the decay rate. For example, if the time unit for the model is weekly, it will represent the percentage of effect each week that is carried over to the following week. The guideline for most common media is: TV c(0.3, 0.8), OOH/Print/Radio c(0.1, 0.4), digital c(0, 0.3).</li><li><strong>Shape</strong>: In weibull adstock, shape controls the decay shape. Recommended ranges are c(0.0001, 2). The larger, the more S-shape. The smaller, the more L-shape.</li><li><strong>Scale</strong>: In weibull adstock, scale controls the decay inflection point. A very conservative recommended range is c(0, 0.1), because scale can increase adstocking half-life greatly.</li><li><strong>Alpha</strong>: In s-curve transformation with hill function (Diminishing returns), alpha is the parameter that controls the shape between exponential and s-shape. The larger the alpha, the more S-shape. The smaller, the more C-shape.</li><li><strong>Gamma</strong>: In s-curve transformation with hill function (Diminishing returns), gamma controls the inflection point. Recommended range is c(0.3, 1). The larger the gamma, the later the inflection point in the response curve.</li></ol></li></ul></li><li>Set each <strong>hyperparameter range</strong>.<ul><li>They either contain two values e.g. c(0, 0.5), or only one value. Defining a single value fixes the parameter and prevents the model from exploring solutions within a certain range.</li></ul></li></ol><hr><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="helper-plots"></a>Helper plots<a class="hash-link" href="#helper-plots" title="Direct link to heading">#</a></h4><p>There are a couple of helper plots that can be useful to understand better how <strong>adstock</strong> and <strong>saturation</strong> curves change when altering their hyperparameters.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="plot_adstock"></a>plot_adstock<a class="hash-link" href="#plot_adstock" title="Direct link to heading">#</a></h4><p>Set to <strong><code>plot_adstock(TRUE)</code></strong> and run the command. This will plot the adstock transformation examples, helping to understand <strong>geometric theta</strong> and <strong>weibull shape/scale</strong> transformation.</p><img alt="adstockintro chart" src="/Robyn/img/adstock-qs.png"><p>Set to <strong><code>plot_saturation(TRUE)</code></strong> and run the command. This will plot the saturation curve transformation example, helping to understand hill, <strong>alpha</strong> and <strong>gamma</strong> transformation.</p><img alt="saturation chart" src="/Robyn/img/saturation-qs.png"><hr><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="examples-for-hypermarameter-definitions"></a>Examples for hypermarameter definitions<a class="hash-link" href="#examples-for-hypermarameter-definitions" title="Direct link to heading">#</a></h4><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_31ik" id="defining-hyper_names-for-geometric-adstock"></a>Defining hyper_names for geometric adstock<a class="hash-link" href="#defining-hyper_names-for-geometric-adstock" title="Direct link to heading">#</a></h5><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">hyper_names(adstock = &quot;geometric&quot;, all_media = InputCollect$all_media)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">hyperparameters &lt;- list(</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  facebook_I_alphas = c(0.5, 3), # example bounds for alpha</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  facebook_I_gammas = c(0.3, 1), # example bounds for gamma</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  facebook_I_thetas = c(0, 0.3), # example bounds for theta</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  tv_S_alphas = c(0.5, 3),</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  tv_S_gammas = c(0.3, 1),</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  tv_S_thetas = c(0.3, 0.8),</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  newsletter_alphas = c(0.5, 3),</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  newsletter_gammas = c(0.3, 1),</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  newsletter_thetas = c(0.1, 0.4)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_31ik" id="defining-hyper_names-for-weibull-adstock"></a>Defining hyper_names for weibull adstock<a class="hash-link" href="#defining-hyper_names-for-weibull-adstock" title="Direct link to heading">#</a></h5><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">hyper_names(adstock = &quot;weibull&quot;, all_media = InputCollect$all_media)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">hyperparameters &lt;- list(</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  facebook_I_alphas = c(0.5, 3), # example bounds for alpha</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  facebook_I_gammas = c(0.3, 1) # example bounds for gamma</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  facebook_I_shapes = c(0.0001, 2), # example bounds for shape</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  facebook_I_scales = c(0, 0.1), # example bounds for scale</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  tv_S_alphas = c(0.5, 3),</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  tv_S_gammas = c(0.3, 1),</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  tv_S_shapes = c(0.0001, 2),</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  tv_S_scales = c(0, 0.1),</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  newsletter_alphas = c(0.5, 3),</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  newsletter_gammas = c(0.3, 1),</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  newsletter_shapes = c(0.0001, 2),</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  newsletter_scales = c(0, 0.1)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="step-2a-3-add-hyperparameters-into-robyn_inputs"></a>Step 2a-3: Add hyperparameters into <code>robyn_inputs()</code><a class="hash-link" href="#step-2a-3-add-hyperparameters-into-robyn_inputs" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">InputCollect &lt;-</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  robyn_inputs(InputCollect = InputCollect, hyperparameters = hyperparameters)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="step-2a-4-model-calibration-optional"></a>Step 2a-4: Model calibration (Optional)<a class="hash-link" href="#step-2a-4-model-calibration-optional" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="how-to-input-details-from-experiments"></a>How to input details from experiments<a class="hash-link" href="#how-to-input-details-from-experiments" title="Direct link to heading">#</a></h4><ol><li>We strongly recommend using experimental and causal results that are considered ground truth to calibrate MMM. Usual experiment types are people-based (e.g. Facebook conversion lift) and geo-based (e.g. Facebook GeoLift).</li><li>Robyn only accepts point-estimates as a calibration input. For example, if 10k$ spend is tested against a holdout for channel A, then input the incremental absolute return as a point-estimate for the test period just like the example below.</li><li>The point-estimate must match the regular spend for the channel measured. For example, if channel A usually has $100k weekly spend and the experimental holdout is 70%, input the point-estimate for the incremental sales resulting from the proportional $30k spent in test, without the $70k from the audience held outside of the study.</li></ol><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain"> dt_calibration &lt;- data.frame(</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   # channel name must be in paid_media_vars</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     channel = c(&quot;facebook_I&quot;,  &quot;tv_S&quot;, &quot;facebook_I&quot;)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   # liftStartDate must be within input data range</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   , liftStartDate = as.Date(c(&quot;2018-05-01&quot;, &quot;2017-11-27&quot;, &quot;2018-07-01&quot;))</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   # liftEndDate must be within input data range</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   , liftEndDate = as.Date(c(&quot;2018-06-10&quot;, &quot;2017-12-03&quot;, &quot;2018-07-20&quot;))</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   # The provided value must be tested on the same</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   # campaign level than the model and same metric as dep_var_type</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   , liftAbs = c(400000, 300000, 200000)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> )</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> InputCollect &lt;- robyn_inputs(InputCollect = InputCollect</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                              , calibration_input = dt_calibration)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="step-2b-for-known-model-specification-how-to-set-it-up-in-one-single-step"></a>Step 2b: For known model specification, how to set it up in one single step<a class="hash-link" href="#step-2b-for-known-model-specification-how-to-set-it-up-in-one-single-step" title="Direct link to heading">#</a></h3><p>You may specify hyperparameters as in 2a-2 and optionally calibration as in 2a-4 and provide them directly in robyn_inputs() function:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain"> InputCollect &lt;- robyn_inputs(</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   dt_input = dt_simulated_weekly</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">...</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">...</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">...</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   ,hyperparameters = hyperparameters # as in 2a-2 above</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   ,calibration_input = dt_calibration # as in 2a-4 above</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> )</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><hr><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="step-3-build-the-initial-model"></a>Step 3: Build the initial model<a class="hash-link" href="#step-3-build-the-initial-model" title="Direct link to heading">#</a></h2><hr><p>Please run first <strong><code>?robyn_run</code></strong> to check the model&#x27;s parameters definition:</p><p>The <code>robyn_run()</code> function consumes the output from <code>robyn_input()</code>, runs the <code>robyn_mmm()</code> functions and plots and collects the results into a defined folder.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">OutputCollect &lt;- robyn_run(</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  InputCollect = InputCollect # feed in all model specification</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  , plot_folder = robyn_object # plots will be saved in the same folder as robyn_object</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  , pareto_fronts = 3</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  , plot_pareto = TRUE</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  )</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Besides the <a target="_blank" href="/Robyn/assets/files/ModelResults1-673b1b79930d5c3f2138cb59c1632dd2.png">one-pager plots</a>: there are <strong>4 .csv outputs</strong> that are saved in the folder for further usage:</p><ul><li><strong><em>pareto_hyperparameters.csv</em></strong>: hyperparameters per pareto output model</li><li><strong><em>pareto_aggregated.csv</em></strong>: aggregated decomposition per independent variable of all pareto outputs</li><li><strong><em>pareto_media_transform_matrix.csv</em></strong>: all media transformation vectors</li><li><strong><em>pareto_alldecomp_matrix.csv</em></strong>: all decomposition vectors of independent variables</li></ul><hr><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="robyn_run-arguments"></a><strong><code>robyn_run()</code> arguments</strong><a class="hash-link" href="#robyn_run-arguments" title="Direct link to heading">#</a></h4><hr><p><strong><code>InputCollect</code></strong>
A list. Contains all input parameters for the model. Required when <code>robyn_object</code> is not provided.</p><p><strong><code>plot_folder</code></strong>
A character. Path for saving plots. Default to <code>robyn_object</code> and saves plot in the same directory as <code>robyn_object</code>.</p><p><strong><code>pareto_fronts</code></strong>
An integer. Number of Pareto fronts for the output. <code>pareto_fronts = 1</code> returns the best models trading off <code>NRMSE &amp; DECOMP.RSSD</code>. Increase <code>pareto_fronts</code> to get more model choices.</p><p><strong><code>plot_pareto</code></strong>
A boolean. Set to FALSE to deactivate plotting and saving model one-pagers. Used when testing models.</p><p><strong><code>refresh</code></strong>
A boolean. Set to <code>TRUE</code> when used in <code>robyn_refresh()</code></p><p><strong><code>dt_hyper_fixed</code></strong>
A data.frame. Only provide when loading old model results. It consumes hyperparameters from saved csv <code>pareto_hyperparameters.csv</code>.</p><p><strong><code>ui</code></strong>
A boolean. Save additional outputs for UI usage. List outcome.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="pareto-model-solutions-plot"></a>Pareto model solutions plot<a class="hash-link" href="#pareto-model-solutions-plot" title="Direct link to heading">#</a></h3><p>After running the model, a Pareto-front chart for the initial model build will be displayed.
This chart shows the performance of the multi-objective optimization from the evolutionary algorithm
platform Nevergrad over 10k iterations in total.</p><img alt="pareto chart 2" src="/Robyn/img/pareto2.png"><p>The two axes (NRMSE on x and DECOMP.RSSD on y) are the two objective functions to be minimized.
As the iteration increases, a trend down the lower left corner of the coordinate can be clearly observed.
This is a proof of Nevergrad&#x27;s ability to drive the model result towards an optimal direction.
The red lines are Pareto-fronts 1-3 and contains the best possible model results from all iterations.</p><hr><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="step-4-select-and-save-your-preferred-initial-model"></a>Step 4: Select and save your preferred initial model<a class="hash-link" href="#step-4-select-and-save-your-preferred-initial-model" title="Direct link to heading">#</a></h2><p>Please compare all model <a target="_blank" href="/Robyn/assets/files/ModelResults1-673b1b79930d5c3f2138cb59c1632dd2.png">one-pager plots</a> in the plot folder and select the one that better represents your business reality:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">OutputCollect$allSolutions # get all model IDs in result</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">select_model &lt;- &quot;5_126_5&quot; # select one from above</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">robyn_save(robyn_object = robyn_object # model object location and name</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">           , select_model = select_model # selected model ID</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">           , InputCollect = InputCollect # all model input</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">           , OutputCollect = OutputCollect # all model output</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><hr><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="step-5-calculate-budget-allocation-based-on-the-selected-model-above"></a>Step 5: Calculate budget allocation based on the selected model above<a class="hash-link" href="#step-5-calculate-budget-allocation-based-on-the-selected-model-above" title="Direct link to heading">#</a></h2><p>The budget allocator result requires further validation. Please use these results with caution. Avoid using or interpreting budget allocation results if the selected results do not meet your business expectations.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Check media summary for selected model</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">OutputCollect$xDecompAgg[solID == select_model &amp; !is.na(mean_spend)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                         , .(rn, coef,mean_spend, mean_response, roi_mean</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                             , total_spend, total_response=xDecompAgg, roi_total, solID)]</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Run <strong><code>?robyn_allocator</code></strong> to check if parameter definitions are correct.</p><p>Run the <code>&quot;max_historical_response&quot;</code> scenario which answers the question:
<em>&quot;How can I improve my overall media investment efficiency, assuming the same historical spend level. What is the optimal spend mix to maximize the response (E.g. sales)?&quot;</em></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">AllocatorCollect &lt;- robyn_allocator(</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  InputCollect = InputCollect</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  , OutputCollect = OutputCollect</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  , select_model = select_model</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  , scenario = &quot;max_historical_response&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  , channel_constr_low = c(0.7, 0.7, 0.7, 0.7, 0.7)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  , channel_constr_up = c(1.2, 1.5, 1.5, 1.5, 1.5)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Observe the allocator results. Last column <strong>&quot;optmResponseUnitTotalLift&quot;</strong> is the total response lift.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">AllocatorCollect$dt_optimOut</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Run the <code>&quot;max_response_expected_spend&quot;</code> scenario which answers:
<em>&quot;What is the maximum response I can obtain for a given total spend, assuming same historical saturation curves. What is the spend mix?&quot;</em></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">AllocatorCollect &lt;- robyn_allocator(</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  InputCollect = InputCollect</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  , OutputCollect = OutputCollect</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  , select_model = select_model</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  , scenario = &quot;max_response_expected_spend&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  , channel_constr_low = c(0.7, 0.7, 0.7, 0.7, 0.7)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  , channel_constr_up = c(1.2, 1.5, 1.5, 1.5, 1.5)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  , expected_spend = 1000000 # Total spend to be simulated</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  , expected_spend_days = 7 # Duration of expected_spend in days</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Observe the allocator results. The column <strong>&quot;optmResponseUnitTotal&quot;</strong> is the maximum unit (weekly with simulated dataset) response. <strong>&quot;optmSpendShareUnit&quot;</strong> is the optimum spend share.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">AllocatorCollect$dt_optimOut</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="budget-allocator-example-plots"></a>Budget allocator example plots<a class="hash-link" href="#budget-allocator-example-plots" title="Direct link to heading">#</a></h3><p>Below there is an example of a budger allocator result plot which is typically saved within the plot folder with all model results plots where your Robyn.RData object resides.
You will find it with the name: <em>[select_model_SolID]_reallocated.png</em></p><img alt="pareto chart 2" src="/Robyn/img/budgerAllocator1.png"><hr><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="robyn_allocator-description"></a><code>robyn_allocator()</code> description<a class="hash-link" href="#robyn_allocator-description" title="Direct link to heading">#</a></h4><hr><p>The <code>robyn_allocator()</code> function returns a new split of media variable spends that maximizes the total media response.</p><hr><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="robyn_allocator-usage"></a><code>robyn_allocator()</code> Usage<a class="hash-link" href="#robyn_allocator-usage" title="Direct link to heading">#</a></h4><hr><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">robyn_allocator(</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  robyn_object = NULL,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  select_build = NULL,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  InputCollect = NULL,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  OutputCollect = NULL,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  select_model = NULL,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  optim_algo = &quot;SLSQP_AUGLAG&quot;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  scenario = &quot;max_historical_response&quot;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  expected_spend = NULL,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  expected_spend_days = NULL,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  channel_constr_low = 0.5,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  channel_constr_up = 2,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  maxeval = 1e+05,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  constr_mode = &quot;eq&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><hr><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="robyn_allocator-arguments"></a><code>robyn_allocator()</code> Arguments<a class="hash-link" href="#robyn_allocator-arguments" title="Direct link to heading">#</a></h4><hr><ul><li><strong><code>robyn_object</code></strong>
A character. This is the path of the <code>Robyn.RData</code> object that contains all previous modeling information.</li><li><strong><code>select_build</code></strong>
An integer. Default to the latest model build. <code>select_build = 0</code> selects the initial model. <code>select_build = 1</code> selects the first refresh model.</li><li><strong><code>InputCollect</code></strong>
A list. Contains all input parameters for the model. Required when <code>robyn_object</code> is not provided.</li><li><strong><code>OutputCollect</code></strong>
A list. Containing all model results. Required when <code>robyn_object</code> is not provided.</li><li><strong><code>select_model</code></strong>
A character. A model <code>SolID</code>. When <code>robyn_object</code> is provided, <code>select_model</code> defaults to the already selected <code>SolID</code>. When <code>robyn_object</code> is not provided, <code>select_model</code> must be provided with <code>InputCollect</code> and <code>OutputCollect</code>, and must be one of the solutions in <code>OutputCollect$allSolutions</code>.</li><li><strong><code>optim_algo</code></strong>
A character. Default is &quot;SLSQP_AUGLAG&quot;, short for &quot;Sequential Least-Squares Quadratic Programming&quot; and &quot;Augmented Lagrangian&quot;. Alternatively, &quot;&quot;MMA_AUGLAG&quot;, short for &quot;Method of Moving Asymptotes&quot;. More details see the documentation of NLopt <a href="https://nlopt.readthedocs.io/en/latest/NLopt_Algorithms/" target="_blank" rel="noopener noreferrer">here</a>.</li><li><strong><code>scenario</code></strong>
A character. Accepted options are: <code>&quot;max_historical_response&quot;</code> or <code>&quot;max_response_expected_spend&quot;</code>.
<code>&quot;max_historical_response&quot;</code> simulates the scenario &quot;what&#x27;s the optimal media spend allocation given the same average spend level in history?&quot;, while <code>&quot;max_response_expected_spend&quot;</code> simulates the scenario &quot;what&#x27;s the optimal media spend allocation of a given future spend level for a given period?&quot;</li><li><strong><code>expected_spend</code></strong>
Numeric. The expected future spend volume. Only applicable when <code>scenario = &quot;max_response_expected_spend&quot;</code>.</li><li><strong><code>expected_spend_days</code></strong>
An integer. The duration of the future spend volume in <code>expected_spend</code>. Only applies when <code>scenario = &quot;max_response_expected_spend&quot;</code>.</li><li><strong><code>channel_constr_low, channel_constr_up</code></strong>
Numeric vector. The lower and upper bounds for each paid media variable when maximizing total media response. <code>channel_constr_low = 0.7</code> means the minimum spend of the channel solution can be as low as 70% of the historical average. Whereas <code>channel_constr_up = 1.5</code> means that the maximum spend of the variable can be up to 150% the historical average. The upper bound must be &gt;= than the lower bound. Both must have the same length and order as <code>paid_media_vars</code>.</li><li><strong><code>maxeval</code></strong>
An integer. The maximum iteration of the global optimization algorithm. Defaults to 100000.</li><li><strong><code>constr_mode</code></strong>
A character. Options are &quot;eq&quot; or &quot;ineq&quot;, indicating constraints with equality or inequality.</li></ul><hr><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="step-6-model-refresh-based-on-selected-model-and-saved-robynrdata-object"></a>Step 6: Model refresh based on selected model and saved Robyn.RData object<a class="hash-link" href="#step-6-model-refresh-based-on-selected-model-and-saved-robynrdata-object" title="Direct link to heading">#</a></h2><p>NOTE: must run robyn_save to select and save an initial model first, before refreshing below
The robyn_refresh() function is suitable for updating within &quot;reasonable periods&quot;
Two situations are considered better to rebuild model:</p><ol><li>When most <strong>data is new</strong>. If initial model has 100 weeks and 80 weeks new data is added in refresh, it might be better to rebuild the model</li><li>When <strong>new variables</strong> are added</li></ol><hr><p>Please run <strong><code>?robyn_refresh</code></strong> to check parameter definition</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">Robyn &lt;- robyn_refresh(</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  robyn_object = robyn_object</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  , dt_input = dt_simulated_weekly</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  , dt_holidays = dt_prophet_holidays</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  , refresh_steps = 13</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  , refresh_mode = &quot;auto&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  , refresh_iters = 1000 # Iteration for refresh. 600 is rough estimation. We&#x27;ll still</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  # figuring out what&#x27;s the ideal number.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  , refresh_trials = 3</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Besides the plots, there are <strong>4 .csv outputs</strong> saved in the folder for further usage:</p><ul><li><strong><em>report_hyperparameters.csv</em></strong>: hyperparameters of all selected model for reporting</li><li><strong><em>report_aggregated.csv</em></strong>: aggregated decomposition per independent variable</li><li><strong><em>report_media_transform_matrix.csv</em></strong>: all media transformation vectors</li><li><strong><em>report_alldecomp_matrix.csv</em></strong>: all decomposition vectors of independent variables</li></ul><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="robyn-refresh-models-example-plots"></a>Robyn refresh models example plots<a class="hash-link" href="#robyn-refresh-models-example-plots" title="Direct link to heading">#</a></h3><p>Below there is an example of the model refresh plot results and how they are fit in time.
As well as, their corresponding plots which reflect the decomposition of each variable effect and ROAS.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="reporting-model-refresh-time-series-fit"></a>Reporting model refresh time-series fit<a class="hash-link" href="#reporting-model-refresh-time-series-fit" title="Direct link to heading">#</a></h4><p>You may observe in the plot below that all initial and refresh builds are included sequentially.
For the refresh builds, only the new periods added will be appended.
The assembled R-squared is adjusted and describes the fit of the assembled actual &amp; fitted lines below.
Refresh builds can have different window lengths (parameter refresh_step in the robyn_refresh() function).</p><img alt="pareto chart 2" src="/Robyn/img/refresh-window.png"><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="reporting-model-refresh-decomposition--roas"></a>Reporting model refresh decomposition &amp; ROAS<a class="hash-link" href="#reporting-model-refresh-decomposition--roas" title="Direct link to heading">#</a></h4><p>The chart below shows the decomposition of all predictors per each model build.
The baseline variable is the sum of all prophet variables (trend, season, weekday, holiday) and the intercept.
Please have in mind that the below data is simulated and for illustration purposes only.</p><img alt="pareto chart 2" src="/Robyn/img/refresh-reporting.png"><hr><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="robyn_refresh-description"></a><code>robyn_refresh()</code> description<a class="hash-link" href="#robyn_refresh-description" title="Direct link to heading">#</a></h4><p>The <code>robyn_refresh()</code> function builds updated models based on the previously built models saved in the Robyn.RData object specified in robyn_object.
For example, when updating the initial build with 4 weeks of new data, <code>robyn_refresh()</code> consumes the selected model of the initial build.</p><p>What Robyn does, is to set lower and upper bounds of hyperparameters for the new build around the selected hyperparameters of the previous build,
stabilizes the effect of baseline variables across old and new builds and regulates the new effect share of media variables towards the latest spend level.
It returns aggregated results with all previous builds for reporting purposes and produces reporting plots.</p><hr><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="robyn_refresh-usage"></a><code>robyn_refresh()</code> usage<a class="hash-link" href="#robyn_refresh-usage" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">robyn_refresh(</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  robyn_object,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  dt_input = dt_input,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  dt_holidays = dt_holidays,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  refresh_steps = 4,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  refresh_mode = &quot;manual&quot;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  refresh_iters = 1000,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  refresh_trials = 3,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  plot_pareto = TRUE</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><hr><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="robyn_refresh-arguments"></a><code>robyn_refresh()</code> arguments<a class="hash-link" href="#robyn_refresh-arguments" title="Direct link to heading">#</a></h4><ul><li><strong><code>robyn_object</code></strong>
A character. Path of the <code>Robyn.RData</code> object that contains all previous modeling information.</li><li><strong><code>dt_input</code></strong>
A data.frame. It should include all previous data and newly added data for the refresh.</li><li><strong><code>dt_holidays</code></strong>
A data.frame. Raw input holiday data. Load standard Prophet holidays using <code>data(&quot;dt_prophet_holidays&quot;)</code>.</li><li><strong><code>refresh_steps</code></strong>
An integer. It controls how many time units the refresh model build will move forward. For example, <code>refresh_steps = 4</code> on weekly data means the <code>InputCollect$window_start</code> &amp; <code>InputCollect$window_end</code> will move forward 4 weeks.</li><li><strong><code>refresh_mode</code></strong>
A character. Options are &quot;auto&quot; and &quot;manual&quot;. In auto mode, the <code>robyn_refresh()</code> function builds refresh models following given <code>refresh_steps</code> repeatedly until there is no more data available. In manual mode, the <code>robyn_refresh()</code> moves forward the <code>refresh_steps</code> only once.</li><li><strong><code>refresh_iters</code></strong>
An integer. The number of iterations per refresh. The rule of thumb is, the more new data added, the more iterations needed.</li><li><strong><code>refresh_trials</code></strong>
An integer. The number of trials per refresh. Defaults to 5 trials.</li><li><strong><code>plot_pareto</code></strong>
A logical value. Set it to FALSE to deactivate plotting and saving model onepagers, commonly used when testing models.</li></ul><hr><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="step-7-get-budget-allocation-recommendation-based-on-selected-refresh-runs"></a>Step 7: Get budget allocation recommendation based on selected refresh runs<a class="hash-link" href="#step-7-get-budget-allocation-recommendation-based-on-selected-refresh-runs" title="Direct link to heading">#</a></h2><p>Please run <strong><code>?robyn_allocator</code></strong> to check if parameter definitions are correct.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">AllocatorCollect &lt;- robyn_allocator(</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  robyn_object = robyn_object</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  , select_build = 3 # Use third refresh model</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  , scenario = &quot;max_response_expected_spend&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  , channel_constr_low = c(0.7, 0.7, 0.7, 0.7, 0.7)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  , channel_constr_up = c(1.2, 1.5, 1.5, 1.5, 1.5)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  , expected_spend = 2000000 # Total spend to be simulated</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  , expected_spend_days = 14 # Duration of expected_spend in days</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">AllocatorCollect$dt_optimOut</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><hr><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="robyn_allocator-description-1"></a><code>robyn_allocator()</code> description<a class="hash-link" href="#robyn_allocator-description-1" title="Direct link to heading">#</a></h4><p>The <code>robyn_allocator()</code> function returns a new split of media variable spends that maximizes the total media response.</p><hr><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="robyn_allocator-usage-1"></a><code>robyn_allocator()</code> Usage<a class="hash-link" href="#robyn_allocator-usage-1" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">robyn_allocator(</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  robyn_object = NULL,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  select_build = NULL,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  InputCollect = NULL,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  OutputCollect = NULL,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  select_model = NULL,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  optim_algo = &quot;SLSQP_AUGLAG&quot;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  scenario = &quot;max_historical_response&quot;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  expected_spend = NULL,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  expected_spend_days = NULL,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  channel_constr_low = 0.5,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  channel_constr_up = 2,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  maxeval = 1e+05,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  constr_mode = &quot;eq&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><hr><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="robyn_allocator-arguments-1"></a><code>robyn_allocator()</code> Arguments<a class="hash-link" href="#robyn_allocator-arguments-1" title="Direct link to heading">#</a></h4><ul><li><strong><code>robyn_object</code></strong>
A character. This is the path of the <code>Robyn.RData</code> object that contains all previous modeling information.</li><li><strong><code>select_build</code></strong>
An integer. Default to the latest model build. <code>select_build = 0</code> selects the initial model. <code>select_build = 1</code> selects the first refresh model.</li><li><strong><code>InputCollect</code></strong>
A list. Contains all input parameters for the model. Required when <code>robyn_object</code> is not provided.</li><li><strong><code>OutputCollect</code></strong>
A list. Containing all model results. Required when <code>robyn_object</code> is not provided.</li><li><strong><code>select_model</code></strong>
A character. A model <code>SolID</code>. When <code>robyn_object</code> is provided, <code>select_model</code> defaults to the already selected <code>SolID</code>. When <code>robyn_object</code> is not provided, <code>select_model</code> must be provided with <code>InputCollect</code> and <code>OutputCollect</code>, and must be one of the solutions in <code>OutputCollect$allSolutions</code>.</li><li><strong><code>optim_algo</code></strong>
A character. Default is &quot;SLSQP_AUGLAG&quot;, short for &quot;Sequential Least-Squares Quadratic Programming&quot; and &quot;Augmented Lagrangian&quot;. Alternatively, &quot;&quot;MMA_AUGLAG&quot;, short for &quot;Method of Moving Asymptotes&quot;. More details see the documentation of NLopt <a href="https://nlopt.readthedocs.io/en/latest/NLopt_Algorithms/" target="_blank" rel="noopener noreferrer">here</a>.</li><li><strong><code>scenario</code></strong>
A character. Accepted options are: <code>&quot;max_historical_response&quot;</code> or <code>&quot;max_response_expected_spend&quot;</code>.
&quot;max_historical_response&quot; simulates the scenario &quot;what&#x27;s the optimal media spend allocation given the same average spend level in history?&quot;, while &quot;max_response_expected_spend&quot; simulates the scenario &quot;what&#x27;s the optimal media spend allocation of a given future spend level for a given period?&quot;</li><li><strong><code>expected_spend</code></strong>
Numeric. The expected future spend volume. Only applicable when <code>scenario = &quot;max_response_expected_spend&quot;</code>.</li><li><strong><code>expected_spend_days</code></strong>
An integer. The duration of the future spend volume in <code>expected_spend</code>. Only applies when <code>scenario = &quot;max_response_expected_spend&quot;</code>.</li><li><strong><code>channel_constr_low, channel_constr_up</code></strong>
Numeric vector. The lower and upper bounds for each paid media variable when maximizing total media response. <code>channel_constr_low = 0.7</code> means the minimum spend of the channel solution can be as low as 70% of the historical average. Whereas <code>channel_constr_up = 1.5</code> means that the maximum spend of the variable can be up to 150% the historical average. The upper bound must be &gt;= than the lower bound. Both must have the same length and order as <code>paid_media_vars</code>.</li><li><strong><code>maxeval</code></strong>
An integer. The maximum iteration of the global optimization algorithm. Defaults to 100000.</li><li><strong><code>constr_mode</code></strong>
A character. Options are &quot;eq&quot; or &quot;ineq&quot;, indicating constraints with equality or inequality.</li></ul><hr><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="step-8-obtain-marginal-returns"></a>Step 8: Obtain marginal returns<a class="hash-link" href="#step-8-obtain-marginal-returns" title="Direct link to heading">#</a></h2><p>The <strong><code>robyn_response()</code></strong> function returns the response for a given spend level of a given <code>paid_media_vars</code> from a selected model result of a selected model build (initial model, refresh model etc.).</p><hr><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="robyn_response-usage"></a><code>robyn_response()</code> Usage<a class="hash-link" href="#robyn_response-usage" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">robyn_response(</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  robyn_object = NULL,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  select_build = NULL,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  media_metric = NULL,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  select_model = NULL,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  metric_value = NULL,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  dt_hyppar = NULL,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  dt_coef = NULL,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  InputCollect = NULL</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><hr><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="robyn_response-arguments"></a><code>robyn_response()</code> Arguments<a class="hash-link" href="#robyn_response-arguments" title="Direct link to heading">#</a></h4><ul><li><strong><code>robyn_object</code></strong>
A character. Path of the <code>Robyn.RData</code> object that contains all previous modeling information.</li><li><strong><code>select_build</code></strong>
An integer. Its default is the latest model build. <code>select_build = 0</code> selects the initial model. <code>select_build = 1</code> selects the first refresh model.</li><li><strong><code>media_metric</code></strong>
A character. The selected paid media variable for the response. Must be one of the paid media variables within <code>InputCollect$paid_media_vars</code></li><li><strong><code>select_model</code></strong>
A character. A model <code>SolID</code>. When <code>robyn_object</code> is provided, <code>select_model</code> defaults to the already selected <code>SolID</code>. When <code>robyn_object</code> is not provided, <code>select_model</code> must be provided with <code>InputCollect</code> and <code>OutputCollect</code>, and must be one of the solutions in <code>OutputCollect$allSolutions</code>.</li><li><strong><code>spend</code></strong>
Numeric. The desired spend level to return a response for.</li><li><strong><code>dt_hyppar</code></strong>
A data.table. When <code>robyn_object</code> is not provided, use <code>dt_hyppar = OutputCollect$resultHypParam</code>. It must be provided along with <code>select_model</code>, <code>dt_coef</code> and <code>InputCollect</code>.</li><li><strong><code>dt_coef</code></strong>
A data.table. When <code>robyn_object</code> is not provided, use <code>dt_coef = OutputCollect$xDecompAgg</code>. It must be provided along with <code>select_model</code>, <code>dt_hyppar</code> and <code>InputCollect</code>.</li><li><strong><code>InputCollect</code></strong>
A list. Contains all input parameters for the model. Required when robyn_object is not provided.</li></ul><hr><p>Below, there is an example of how to get marginal ROI of next 1000$ from an initial $80k spend level for the search channel:</p><p>First run <strong><code>?robyn_response</code></strong> to check the parameter definition</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Get response for 80k</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Spend1 &lt;- 80000</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Response1 &lt;- robyn_response(</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  robyn_object = robyn_object</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  #, select_build = 1 # 2 means the second refresh model. 0 means the initial model</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  , media_metric = &quot;search_S&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  , metric_value = Spend1)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Response1/Spend1 # ROI for search 80k</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Get response for 81k</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Spend2 &lt;- Spend1+1000</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Response2 &lt;- robyn_response(</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  robyn_object = robyn_object</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  #, select_build = 1</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  , media_metric = &quot;search_S&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  , metric_value = Spend2)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Response2/Spend2 # ROI for search 81k</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Marginal ROI of next 1000$ from 80k spend level for search</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">(Response2-Response1)/(Spend2-Spend1)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="optional-get-old-model-results"></a>Optional: get old model results<a class="hash-link" href="#optional-get-old-model-results" title="Direct link to heading">#</a></h3><hr><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="get-old-hyperparameters-and-select-model"></a>Get old hyperparameters and select model<a class="hash-link" href="#get-old-hyperparameters-and-select-model" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">dt_hyper_fixed &lt;- fread(&quot;~/Desktop/2021-07-29 00.56 init/pareto_hyperparameters.csv&quot;)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">select_model &lt;- &quot;1_24_5&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">dt_hyper_fixed &lt;- dt_hyper_fixed[solID == select_model]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">OutputCollectFixed &lt;- robyn_run(</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  # InputCollect must be provided by robyn_inputs with same dataset and parameters as before</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  InputCollect = InputCollect</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  , plot_folder = robyn_object</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  , dt_hyper_fixed = dt_hyper_fixed)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="save-robyn-object-for-further-refresh"></a>Save Robyn object for further refresh<a class="hash-link" href="#save-robyn-object-for-further-refresh" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">robyn_save(robyn_object = robyn_object</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">           , select_model = select_model</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">           , InputCollect = InputCollect</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">           , OutputCollect = OutputCollectFixed)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><hr></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebookexperimental/Robyn/docs/demo-R-script.mdx" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/Robyn/docs/quick-start"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Quick Start</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/Robyn/docs/step-by-step-videos"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Walkthrough videos »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#step-1-load-the-data" class="table-of-contents__link">Step 1: Load the data</a></li><li><a href="#step-2--model-specifications" class="table-of-contents__link">Step 2:  Model specifications</a><ul><li><a href="#step-2a-1-specifying-the-input-data-and-model-parameters" class="table-of-contents__link">Step 2a-1: Specifying the input data and model parameters</a></li><li><a href="#step-2a-2-defining-hyperparameters" class="table-of-contents__link">Step 2a-2: Defining hyperparameters</a></li><li><a href="#step-2a-3-add-hyperparameters-into-robyn_inputs" class="table-of-contents__link">Step 2a-3: Add hyperparameters into <code>robyn_inputs()</code></a></li><li><a href="#step-2a-4-model-calibration-optional" class="table-of-contents__link">Step 2a-4: Model calibration (Optional)</a></li><li><a href="#step-2b-for-known-model-specification-how-to-set-it-up-in-one-single-step" class="table-of-contents__link">Step 2b: For known model specification, how to set it up in one single step</a></li></ul></li><li><a href="#step-3-build-the-initial-model" class="table-of-contents__link">Step 3: Build the initial model</a><ul><li><a href="#pareto-model-solutions-plot" class="table-of-contents__link">Pareto model solutions plot</a></li></ul></li><li><a href="#step-4-select-and-save-your-preferred-initial-model" class="table-of-contents__link">Step 4: Select and save your preferred initial model</a></li><li><a href="#step-5-calculate-budget-allocation-based-on-the-selected-model-above" class="table-of-contents__link">Step 5: Calculate budget allocation based on the selected model above</a><ul><li><a href="#budget-allocator-example-plots" class="table-of-contents__link">Budget allocator example plots</a></li></ul></li><li><a href="#step-6-model-refresh-based-on-selected-model-and-saved-robynrdata-object" class="table-of-contents__link">Step 6: Model refresh based on selected model and saved Robyn.RData object</a><ul><li><a href="#robyn-refresh-models-example-plots" class="table-of-contents__link">Robyn refresh models example plots</a></li></ul></li><li><a href="#step-7-get-budget-allocation-recommendation-based-on-selected-refresh-runs" class="table-of-contents__link">Step 7: Get budget allocation recommendation based on selected refresh runs</a></li><li><a href="#step-8-obtain-marginal-returns" class="table-of-contents__link">Step 8: Obtain marginal returns</a><ul><li><a href="#optional-get-old-model-results" class="table-of-contents__link">Optional: get old model results</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/facebookexperimental/Robyn" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.facebook.com/business/success/resident" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Case study: Resident<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.facebook.com/business/success/central-retail-corporation" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Case study: Central Group<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://www.facebook.com/groups/954715125296621" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Robyn MMM Users Facebook Group<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/facebookexperimental/Robyn/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Raise an issue on Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Legal</div><ul class="footer__items"><li class="footer__item"><a href="https://opensource.facebook.com/legal/privacy/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Privacy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/terms/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Terms<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://opensource.facebook.com" target="_blank" rel="noopener noreferrer" class="footerLogoLink_MyFc"><img src="/Robyn/img/oss_logo.png" alt="Facebook Open Source Logo" class="themedImage_1VuW themedImage--light_3UqQ footer__logo"><img src="/Robyn/img/oss_logo.png" alt="Facebook Open Source Logo" class="themedImage_1VuW themedImage--dark_hz6m footer__logo"></a></div><div class="footer__copyright">Copyright © 2022 Facebook, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/Robyn/assets/js/runtime~main.30fdf14c.js"></script>
<script src="/Robyn/assets/js/main.0ba7addf.js"></script>
</body>
</html>